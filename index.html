<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>School Daybook â€” Supabase Ready</title>

  <!-- Babel Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙˆØ§ÙÙ‚ -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Ù…ÙƒØªØ¨Ø© Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>

  <style>
    body{font-family:"Noto Sans Arabic",system-ui,Arial;background:#f5f7fb;margin:0;padding:0}
    header{background:#0f172a;color:#fff;padding:14px;font-weight:700}
    .wrap{max-width:1100px;margin:20px auto;padding:0 12px}
    .tabs{display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap}
    .tabs button{padding:8px 14px;border:1px solid #cbd5e1;border-radius:8px;cursor:pointer;background:#fff}
    .tabs button.active{background:#2563eb;color:#fff}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:14px;margin-bottom:16px}
    table{width:100%;border-collapse:collapse}
    th,td{border:1px solid #e5e7eb;padding:8px;text-align:right}
    th{background:#f3f4f6}
    input,select,button{font:inherit;padding:6px 10px;border-radius:6px;border:1px solid #d1d5db}
    button{cursor:pointer}
  </style>
</head>
<body>
  <header>ğŸ“˜ School Daybook â€” Supabase</header>
  <div class="wrap">
    <div class="tabs">
      <button data-tab="students" class="active">Ø§Ù„Ø·Ù„Ø§Ø¨</button>
      <button data-tab="attendance">Ø§Ù„Ø­Ø¶ÙˆØ±</button>
      <button data-tab="behavior">Ø§Ù„Ø³Ù„ÙˆÙƒ</button>
      <button data-tab="grades">Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</button>
      <button data-tab="attachments">Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª</button>
    </div>

    <!-- Ø§Ù„Ø·Ù„Ø§Ø¨ -->
    <section id="tab-students" class="card">
      <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
      <div>
        <input id="studentName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨"/>
        <input id="studentClass" placeholder="Ø§Ù„ØµÙ/Ø§Ù„Ø´Ø¹Ø¨Ø©"/>
        <button id="addStudent">Ø¥Ø¶Ø§ÙØ©</button>
      </div>
      <table>
        <thead><tr><th>#</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ØµÙ</th></tr></thead>
        <tbody id="tblStudents"></tbody>
      </table>
    </section>

    <!-- Ø§Ù„Ø­Ø¶ÙˆØ± -->
    <section id="tab-attendance" class="card" hidden>
      <h3>Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
      <div>
        <select id="selStudentA"></select>
        <input id="dateA" type="date"/>
        <select id="statusA">
          <option value="present">Ø­Ø§Ø¶Ø±</option>
          <option value="absent">ØºØ§Ø¦Ø¨</option>
          <option value="late">Ù…ØªØ£Ø®Ø±</option>
        </select>
        <select id="periodA">
          <option value="1">Ø§Ù„Ø­ØµØ© 1</option><option value="2">Ø§Ù„Ø­ØµØ© 2</option>
          <option value="3">Ø§Ù„Ø­ØµØ© 3</option><option value="4">Ø§Ù„Ø­ØµØ© 4</option>
          <option value="5">Ø§Ù„Ø­ØµØ© 5</option><option value="6">Ø§Ù„Ø­ØµØ© 6</option>
          <option value="7">Ø§Ù„Ø­ØµØ© 7</option>
        </select>
        <button id="addAttendance">Ø­ÙØ¸</button>
      </div>
      <table>
        <thead><tr><th>#</th><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø­ØµØ©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead>
        <tbody id="tblAttendance"></tbody>
      </table>
    </section>

    <!-- Ø§Ù„Ø³Ù„ÙˆÙƒ -->
    <section id="tab-behavior" class="card" hidden>
      <h3>Ø§Ù„Ø³Ù„ÙˆÙƒ</h3>
      <div>
        <select id="selStudentB"></select>
        <input id="dateB" type="date"/>
        <select id="typeB">
          <option value="positive">Ø¥ÙŠØ¬Ø§Ø¨ÙŠ</option>
          <option value="negative">Ø³Ù„Ø¨ÙŠ</option>
        </select>
        <select id="periodB">
          <option value="1">Ø§Ù„Ø­ØµØ© 1</option><option value="2">Ø§Ù„Ø­ØµØ© 2</option>
          <option value="3">Ø§Ù„Ø­ØµØ© 3</option><option value="4">Ø§Ù„Ø­ØµØ© 4</option>
          <option value="5">Ø§Ù„Ø­ØµØ© 5</option><option value="6">Ø§Ù„Ø­ØµØ© 6</option>
          <option value="7">Ø§Ù„Ø­ØµØ© 7</option>
        </select>
        <button id="addBehavior">Ø­ÙØ¸</button>
      </div>
      <table>
        <thead><tr><th>#</th><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø­ØµØ©</th><th>Ø§Ù„Ù†ÙˆØ¹</th></tr></thead>
        <tbody id="tblBehavior"></tbody>
      </table>
    </section>

    <!-- Ø§Ù„Ø¯Ø±Ø¬Ø§Øª -->
    <section id="tab-grades" class="card" hidden>
      <h3>Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</h3>
      <div>
        <select id="selStudentG"></select>
        <select id="itemG">
          <option value="participation">Ù…Ø´Ø§Ø±ÙƒØ©</option>
          <option value="homework">ÙˆØ§Ø¬Ø¨</option>
          <option value="quiz">Ø§Ø®ØªØ¨Ø§Ø± Ù‚ØµÙŠØ±</option>
          <option value="final">Ù†Ù‡Ø§Ø¦ÙŠ</option>
        </select>
        <input id="scoreG" type="number" placeholder="Ø§Ù„Ø¯Ø±Ø¬Ø©"/>
        <button id="addGrade">Ø­ÙØ¸</button>
      </div>
      <table>
        <thead><tr><th>#</th><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„Ø¨Ù†Ø¯</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th></tr></thead>
        <tbody id="tblGrades"></tbody>
      </table>
    </section>

    <!-- Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª -->
    <section id="tab-attachments" class="card" hidden>
      <h3>Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª</h3>
      <div>
        <select id="selStudentF"></select>
        <input type="file" id="fileInput"/>
        <button id="uploadFile">Ø±ÙØ¹</button>
      </div>
      <ul id="fileList"></ul>
    </section>
  </div>

  <!-- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
  <script type="text/babel">
  // Supabase config (Ù…ÙØ§ØªÙŠØ­Ùƒ Ù‡Ù†Ø§)
  const SUPABASE_URL = "https://alamidjtlxuquvjvvcac.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFsYW1pZGp0bHh1cXV2anZ2Y2FjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwNDAwMTMsImV4cCI6MjA3MTYxNjAxM30.WGMo2sdJszJRp4Pkf91BfL7OOWrjNV_z82L8T-ZrjtU";

  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  // ========== ØªØ¨ÙˆÙŠØ¨Ø§Øª ==========
  document.querySelectorAll('.tabs button').forEach(btn=>{
    btn.addEventListener('click',()=>{
      document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      let t = btn.dataset.tab;
      document.querySelectorAll('section[id^="tab-"]').forEach(sec=>{
        sec.hidden = sec.id !== "tab-"+t;
      });
    });
  });

  // ========== Ø§Ù„Ø·Ù„Ø§Ø¨ ==========
  let students = [];
  async function loadStudents(){
    let { data } = await sb.from("students").select("*");
    students = data||[];
    renderStudents();
  }
  function renderStudents(){
    const tbody = document.getElementById("tblStudents");
    tbody.innerHTML = students.map((s,i)=>
      `<tr><td>${i+1}</td><td>${s.name}</td><td>${s.classroom||""}</td></tr>`
    ).join("");
    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
    ["selStudentA","selStudentB","selStudentG","selStudentF"].forEach(id=>{
      document.getElementById(id).innerHTML = students.map(s=>`<option value="${s.id}">${s.name}</option>`).join("");
    });
  }
  document.getElementById("addStudent").onclick = async ()=>{
    const name = document.getElementById("studentName").value;
    const classroom = document.getElementById("studentClass").value;
    let { data } = await sb.from("students").insert({ name, classroom }).select();
    if(data){ students.push(data[0]); renderStudents(); }
  };

  // ========== Ø§Ù„Ø­Ø¶ÙˆØ± ==========
  let attendance = [];
  async function renderAttendance(){
    const tbody = document.getElementById("tblAttendance");
    tbody.innerHTML = attendance.map((a,i)=>{
      const stu = students.find(s=>s.id===a.student_id);
      return `<tr><td>${i+1}</td><td>${stu?stu.name:""}</td><td>${a.date}</td><td>${a.period}</td><td>${a.status}</td></tr>`;
    }).join("");
  }
  document.getElementById("addAttendance").onclick = async ()=>{
    const student_id = document.getElementById("selStudentA").value;
    const date = document.getElementById("dateA").value;
    const status = document.getElementById("statusA").value;
    const period = parseInt(document.getElementById("periodA").value,10);
    let { data } = await sb.from("attendance_entries").insert({ student_id,date,status,period }).select();
    if(data){ attendance.push(data[0]); renderAttendance(); }
  };

  // ========== Ø§Ù„Ø³Ù„ÙˆÙƒ ==========
  let behavior = [];
  async function renderBehavior(){
    const tbody = document.getElementById("tblBehavior");
    tbody.innerHTML = behavior.map((b,i)=>{
      const stu = students.find(s=>s.id===b.student_id);
      return `<tr><td>${i+1}</td><td>${stu?stu.name:""}</td><td>${b.date}</td><td>${b.period}</td><td>${b.type}</td></tr>`;
    }).join("");
  }
  document.getElementById("addBehavior").onclick = async ()=>{
    const student_id = document.getElementById("selStudentB").value;
    const date = document.getElementById("dateB").value;
    const type = document.getElementById("typeB").value;
    const period = parseInt(document.getElementById("periodB").value,10);
    let { data } = await sb.from("behavior").insert({ student_id,date,type,period }).select();
    if(data){ behavior.push(data[0]); renderBehavior(); }
  };

  // ========== Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ==========
  let grades = [];
  async function renderGrades(){
    const tbody = document.getElementById("tblGrades");
    tbody.innerHTML = grades.map((g,i)=>{
      const stu = students.find(s=>s.id===g.student_id);
      return `<tr><td>${i+1}</td><td>${stu?stu.name:""}</td><td>${g.item}</td><td>${g.score}</td></tr>`;
    }).join("");
  }
  document.getElementById("addGrade").onclick = async ()=>{
    const student_id = document.getElementById("selStudentG").value;
    const item = document.getElementById("itemG").value;
    const score = parseFloat(document.getElementById("scoreG").value);
    let { data } = await sb.from("grades").insert({ student_id,item,score }).select();
    if(data){ grades.push(data[0]); renderGrades(); }
  };

  // ========== Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª ==========
  document.getElementById("uploadFile").onclick = async ()=>{
    const sid = document.getElementById("selStudentF").value;
    const file = document.getElementById("fileInput").files[0];
    if(!file) return;
    const path = sid+"/"+Date.now()+"_"+file.name;
    let { error } = await sb.storage.from("student-docs").upload(path,file);
    if(!error){
      const url = sb.storage.from("student-docs").getPublicUrl(path).data.publicUrl;
      document.getElementById("fileList").innerHTML += `<li><a href="${url}" target="_blank">${file.name}</a></li>`;
    }
  };

  // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
  loadStudents();
  </script>
</body>
</html>
